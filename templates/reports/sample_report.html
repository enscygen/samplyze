<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Sample Report: {{ sample.sample_uid }}</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            font-size: 10pt;
            color: #333;
        }

        .header {
            text-align: center;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .header img {
            max-height: 60px;
            margin-bottom: 10px;
        }

        .header h1 {
            margin: 0;
            font-size: 18pt;
        }

        .header p {
            margin: 0;
            color: #666;
        }

        .section {
            margin-bottom: 20px;
        }

        .section h2 {
            font-size: 14pt;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-bottom: 10px;
            color: #0056b3;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .details-table {
            width: 100%;
            border-collapse: collapse;
        }

        .details-table td {
            padding: 6px 0;
            vertical-align: top;
        }

        .details-table .label {
            font-weight: bold;
            width: 40%;
        }

        .details-table .value {
            width: 60%;
        }

        .diagnosis {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            page-break-inside: avoid;
        }

        .diagnosis h3 {
            font-size: 12pt;
            margin-top: 0;
        }

        .image-gallery img {
            width: 100%;
            height: auto;
            border: 1px solid #ddd;
            padding: 3px;
            margin-bottom: 5px;
            max-width: 200px;
        }

        .page-break {
            page-break-before: always;
        }

        @media print {
            body {
                -webkit-print-color-adjust: exact;
            }

            .no-print {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        {% if lab_settings and lab_settings.logo_path %}
        <img src="{{ url_for('uploaded_file', filename=lab_settings.logo_path, _external=True) }}" alt="Logo">
        {% endif %}
        <h1>{{ lab_settings.lab_name if lab_settings else 'Laboratory Report' }}</h1>
        <p>{{ lab_settings.address if lab_settings else '' }}</p>
    </div>

    <div class="section">
        <h2>Sample Summary</h2>
        <div class="grid-container">
            <div>
                <table class="details-table">
                    <tr>
                        <td class="label">Sample UID</td>
                        <td class="value">{{ sample.sample_uid }}</td>
                    </tr>
                    <tr>
                        <td class="label">Sample Name</td>
                        <td class="value">{{ sample.sample_name or 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td class="label">Sample Type</td>
                        <td class="value">{{ sample.sample_type or 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td class="label">Status</td>
                        <td class="value">{{ sample.current_status }}</td>
                    </tr>
                </table>
            </div>
            <div>
                <table class="details-table">
                    <tr>
                        <td class="label">Applicant Name</td>
                        <td class="value">{{ sample.applicant.name }}</td>
                    </tr>
                    <tr>
                        <td class="label">Applicant UID</td>
                        <td class="value">{{ sample.applicant.uid }}</td>
                    </tr>
                    <tr>
                        <td class="label">Submission Date</td>
                        <td class="value">{{ sample.submission_date.strftime('%d-%b-%Y') }}</td>
                    </tr>
                    <tr>
                        <td class="label">Collection Date</td>
                        <td class="value">{{ sample.collection_date.strftime('%d-%b-%Y') if sample.collection_date else
                            'N/A' }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    {% if sample.images %}
    <div class="section image-gallery">
        <h2>Sample Images</h2>
        {% for image in sample.images %}
        <img src="{{ url_for('uploaded_file', filename=image.image_path, _external=True) }}" alt="{{ image.caption }}">
        <p>{{ image.caption }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <div class="section">
        <h2>Diagnosis & Observations</h2>
        {% if sample.diagnoses %}
        {% for diagnosis in sample.diagnoses %}
        <div class="diagnosis">
            <h3>{{ diagnosis.title }} ({{ diagnosis.name }})</h3>
            <p><strong>Date:</strong> {{ diagnosis.created_at.strftime('%d-%b-%Y %I:%M %p') }}</p>
            <strong>Description / Method:</strong>
            <div>{{ diagnosis.description | nl2br | safe or 'N/A' }}</div>
            <br>
            <strong>Result / Observations:</strong>
            <div>{{ diagnosis.result | nl2br | safe or 'N/A' }}</div>

            {% if diagnosis.attachments %}
            <strong>Attachments:</strong>
            <ul>
                {% for attachment in diagnosis.attachments %}
                <li>{{ attachment.original_filename }} ({{ attachment.file_type }})</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        {% endfor %}
        {% else %}
        <p>No diagnosis records found for this sample.</p>
        {% endif %}
    </div>

    <script>
        window.onload = function () {
            window.print();
        }
    </script>
</body>

</html>